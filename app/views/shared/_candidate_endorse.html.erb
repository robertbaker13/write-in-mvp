<% @endorsed_candidates.each_with_index do |twitteruser, index| %>
<div class='rcorners bg-w row txt-c'>
  <img src="<%= twitteruser.image %>" alt="" class='mg p-s col-md-2'>
  <div class='col-md-9 mg p-s debug'>
  <a href="<%= show_path(twitteruser) %>">
    <strong>
      <%= twitteruser.name %>
    </strong>
  </a>
  <ul class='mg-l'>
    <li><%= twitteruser.description %></li>
    <li>
      <% if session[:current_user_id].to_s == params[:id] %>
        <%= button_to "Unendorse", unendorse_path(twitteruser.user), :class => "btn-danger btn-xs unendorse-button" %>
      <% end %>
    </li>
  </ul>
</div>
</div>
<% end %>


<script>
$(document).ready(function(){
  unendorseListener();
})

var unendorseListener = function(){
  $("input.btn-danger.btn-xs.unendorse-button").on("click", function(e){
    e.preventDefault();
    var url = this.parentElement.action;
    var $target = $(this).closest(".rcorners.bg-w.row.txt-c");
    unendorse(url, $target);
  })

var unendorse = function(url, $target) {
  $.ajax({
    url: url,
    method: "post"
  }).done(function(){
      $target.toggle("fast");
    }).fail(function(){
      console.log("fail");
    })
  }
}

</script>
